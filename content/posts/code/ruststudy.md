---
title: "Rustç¼–ç¨‹è¯­è¨€å…¥é—¨"
date: 2023-02-14T21:16:03+08:00
draft: false
Tags : ["Rust"]
Categories : ["Rust"]
---

# Rust ç¼–ç¨‹è¯­è¨€å…¥é—¨

## Rustç®€ä»‹

### ä¸ºä»€ä¹ˆè¦ç”¨Rustï¼Ÿ

- Rustæ˜¯ä¸€ç§ä»¤äººå…´å¥‹çš„æ–°ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒå¯ä»¥è®©æ¯ä¸ªäººç¼–å†™å¯é ä¸”é«˜æ•ˆçš„è½¯ä»¶ã€‚
- å®ƒå¯ä»¥ç”¨æ¥æ›¿æ¢C/C++ï¼ŒRustå’Œä»–ä»¬å…·æœ‰åŒæ ·çš„æ€§èƒ½ï¼Œä½†æ˜¯å¾ˆå¤šå¸¸è§çš„bugåœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥è¢«æ¶ˆç­ã€‚
- Rustæ˜¯ä¸€ç§é€šç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯å®ƒæ›´å–„äºä»¥ä¸‹åœºæ™¯ï¼š
  - éœ€è¦è¿è¡Œæ—¶çš„é€Ÿåº¦
  - éœ€è¦å†…å­˜å®‰å…¨
  - æ›´å¥½çš„åˆ©ç”¨å¤šå¤„ç†å™¨

### ä¸å…¶ä»–è¯­è¨€æ¯”è¾ƒ

- C/C++æ€§èƒ½éå¸¸å¥½ï¼Œä½†ç±»å‹ç³»ç»Ÿå’Œå†…å­˜éƒ½ä¸å¤ªå®‰å…¨ã€‚
- Java/C#ï¼Œæ‹¥æœ‰GCï¼Œèƒ½ä¿è¯å†…å­˜å®‰å…¨ï¼Œä¹Ÿæœ‰å¾ˆå¤šä¼˜ç§€ç‰¹æ€§ï¼Œä½†æ˜¯æ€§èƒ½ä¸è¡Œã€‚
- Rustï¼š
  - å®‰å…¨
  - æ— éœ€GCï¼ˆæ€§èƒ½å¥½é€Ÿåº¦å¿«ï¼‰
  - æ˜“äºç»´æŠ¤ã€è°ƒè¯•ã€ä»£ç å®‰å…¨é«˜æ•ˆ

### Rustç‰¹åˆ«æ“…é•¿çš„é¢†åŸŸ

- é«˜æ€§èƒ½ Web Service (Web API)
- WebAssembly
- å‘½ä»¤è¡Œå·¥å…·
- ç½‘ç»œç¼–ç¨‹
- åµŒå…¥å¼è®¾å¤‡
- ç³»ç»Ÿç¼–ç¨‹

### Rustä¸Firefox

- Rustæœ€åˆæ˜¯Mazillaå…¬å¸çš„ä¸€ä¸ªç ”ç©¶æ€§é¡¹ç›®ã€‚Firefoxæ˜¯Rustäº§å“åº”ç”¨çš„ä¸€ä¸ªé‡è¦çš„ä¾‹å­ã€‚
- Mazilla ä¸€ç›´ä»¥æ¥éƒ½åœ¨ç”¨Ruståˆ›å»ºä¸€ä¸ªåä¸ºServoçš„å®éªŒæ€§æµè§ˆå™¨å¼•æ“ï¼Œå…¶ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ã€‚
  - ç›®å‰Servoçš„éƒ¨åˆ†åŠŸèƒ½å·²ç»è¢«é›†æˆåˆ°Firefoxé‡Œé¢äº†
- FirefoxåŸæ¥çš„é‡å­ç‰ˆå°±åŒ…å«äº†Servoçš„CSSæ¸²æŸ“å¼•æ“
  - Rustä½¿å¾—Firefoxåœ¨è¿™æ–¹é¢å¾—åˆ°äº†å·¨å¤§çš„æ€§èƒ½æ”¹è¿›

### Rustçš„ç”¨æˆ·å’Œæ¡ˆä¾‹

- Googleï¼šæ–°æ“ä½œç³»ç»ŸFuschiaï¼Œå…¶ä¸­Rustä»£ç é‡å¤§çº¦å 30%
- Amazonï¼šåŸºäºLinuxå¼€å‘çš„ç›´æ¥å¯ä»¥åœ¨è£¸æœºã€è™šæœºä¸Šè¿è¡Œå®¹å™¨çš„æ“ä½œç³»ç»Ÿ
- System76ã€ç™¾åº¦ã€åä¸ºã€èš‚èšé‡‘æœ...

### Rustçš„ä¼˜ç‚¹

- æ€§èƒ½
- å®‰å…¨æ€§
- æ— æ‰€ç•æƒ§çš„å¹¶å‘

### Rustçš„ç¼ºç‚¹

- å­¦ä¹ æ›²çº¿é«˜ â€éš¾å­¦â€œ

### æ³¨æ„

- Rustæœ‰å¾ˆå¤šç‹¬æœ‰çš„æ¦‚å¿µï¼Œè¦ä¸€æ­¥ä¸€æ­¥å­¦ä¹ 

## Rust å®‰è£…

å®˜ç½‘ï¼š<https://www.rust-lang.org/zh-CN/learn/get-started>

Windowsï¼šæŒ‰å®˜ç½‘æŒ‡ç¤ºæ“ä½œ

Mac å®‰è£…ï¼š

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

```

![](https://raw.githubusercontent.com/qiaopengjun5162/blogpicgo/master/img/202302181555079.png)

### æ›´æ–°ä¸å¸è½½Rust

- æ›´æ–°Rust

```rust
rustup update
```

- å¸è½½Rust

```rust
rustup self uninstall
```

### å®‰è£…éªŒè¯

- `rustc --version`
  - ç»“æ„æ ¼å¼ï¼šrustc x.y.z(abcdbcdbc yyyy-mm-dd)
  - ä¼šç°å®æœ€æ–°ç¨³å®šç‰ˆï¼šç‰ˆæœ¬å·ã€commit hashã€commitæ—¥æœŸ

### æœ¬åœ°æ–‡æ¡£

- å®‰è£…Rustçš„æ—¶å€™ï¼Œä¼šåœ¨æœ¬åœ°å®‰è£…æ–‡æ¡£ï¼Œå¯ç¦»çº¿æµè§ˆ
- è¿è¡Œ`rustup doc`å¯åœ¨æµè§ˆå™¨æ‰“å¼€æœ¬åœ°æ–‡æ¡£

```bash
âœ cargo --version
cargo 1.67.1 (8ecd4f20a 2023-01-10)

~
âœ rustc --version
rustc 1.67.1 (d5a82bbd2 2023-02-07)

~
âœ rustup doc
```

### å¼€å‘å·¥å…·

- Visual Studio Code
  - Rust æ’ä»¶
- Pycharmï¼ˆIntellij Idea ç³»åˆ—ï¼‰
  - Rustæ’ä»¶

### Hello World ä¾‹å­

ç¼–å†™Rustç¨‹åº

- ç¨‹åºæ–‡ä»¶åç¼€åï¼šrs
- æ–‡ä»¶å‘½åè§„èŒƒï¼šhello_world.rs

```bash
âœ mkdir rust

~
âœ cd rust

~/rust
âœ mkdir hello_world

~/rust
âœ cd hello_world

~/rust/hello_world
âœ code .

~/rust/hello_world
âœ pwd
/Users/qiaopengjun/rust/hello_world

~/rust/hello_world via ğŸ¦€ 1.67.1
âœ mv hello_world.rs main.rs

~/rust/hello_world via ğŸ¦€ 1.67.1
âœ rustc main.rs

~/rust/hello_world via ğŸ¦€ 1.67.1
âœ ls
main    main.rs

âœ ./main
Hello World!
```

main.rs`æ–‡ä»¶

```rust
fn main() {
    println!("Hello World!");
}
```

### Rust ç¨‹åºè§£å‰–

- å®šä¹‰å‡½æ•°ï¼š`fn main(){}`
  - æ²¡æœ‰å‚æ•°ï¼Œæ²¡æœ‰è¿”å›
- `main`å‡½æ•°å¾ˆç‰¹åˆ«ï¼šå®ƒæ˜¯æ¯ä¸ªRustå¯æ‰§è¡Œç¨‹åºæœ€å…ˆè¿è¡Œçš„ä»£ç 
- æ‰“å°æ–‡æœ¬ï¼š`printIn!("Hello, world!");`
  - Rustçš„ç¼©è¿›æ˜¯4ä¸ªç©ºæ ¼è€Œä¸æ˜¯tab
  - printIn!æ˜¯ä¸€ä¸ªRust macroï¼ˆå®ï¼‰
    - å¦‚æœæ˜¯å‡½æ•°çš„è¯ï¼Œå°±æ²¡æœ‰!
  - "Hello World" æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒæ˜¯printIn!çš„å‚æ•°
  - è¿™è¡Œä»£ç ä»¥;ç»“å°¾

## ç¼–è¯‘å’Œè¿è¡Œæ˜¯å•ç‹¬çš„ä¸¤æ­¥

- è¿è¡ŒRustç¨‹åºä¹‹å‰å¿…é¡»å…ˆç¼–è¯‘ï¼Œå‘½ä»¤ä¸ºï¼š`rustc`æºæ–‡ä»¶å
  - `rustc main.rs`
- ç¼–è¯‘æˆåŠŸåï¼Œä¼šç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶
  - åœ¨Windowsä¸Šè¿˜ä¼šç”Ÿäº§ä¸€ä¸ª`.pdb`æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«è°ƒè¯•ä¿¡æ¯
- Rustæ˜¯ahead-of-timeç¼–è¯‘çš„è¯­è¨€ï¼ˆé¢„å…ˆç¼–è¯‘ï¼‰
  - å¯ä»¥å…ˆç¼–è¯‘ç¨‹åºï¼Œç„¶åæŠŠå¯æ‰§è¡Œæ–‡ä»¶äº¤ç»™åˆ«äººè¿è¡Œï¼ˆæ— éœ€å®‰è£…Rustï¼‰
- Rustc åªé€‚åˆç®€å•çš„Rustç¨‹åº...

### Hello Cargo

### Cargo

- Cargo æ˜¯Rustçš„æ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å·¥å…·
  - æ„å»ºä»£ç ã€ä¸‹è½½ä¾èµ–çš„åº“ã€æ„å»ºè¿™äº›è‹¦...
- å®‰è£…Rustçš„æ—¶å€™ä¼šå®‰è£…Cargo
  - Cargo --version

```rust
~/rust/hello_world via ğŸ¦€ 1.67.1
âœ cargo --version
cargo 1.67.1 (8ecd4f20a 2023-01-10)
```

### ä½¿ç”¨Cargoåˆ›å»ºé¡¹ç›®

- åˆ›å»ºé¡¹ç›®ï¼š`cargo new hello_cargo`
  - é¡¹ç›®åç§°ä¹Ÿæ˜¯`hello_cargo`
  - ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•`hello_cargo`
    - Cargo.toml
    - srcç›®å½•
      - `main.rs`
    - åˆå§‹åŒ–äº†ä¸€ä¸ªæ–°çš„Gitä»“åº“ `.gitignore`
      - å¯ä»¥ä½¿ç”¨å…¶å®ƒçš„VCSæˆ–ä¸ä½¿ç”¨VCSï¼šcargo new çš„æ—¶å€™ä½¿ç”¨ --vcs è¿™ä¸ªflag

```bash
~/rust
âœ cargo new hello_cargo
     Created binary (application) `hello_cargo` package

~/rust

âœ ls
hello_cargo hello_world

~/rust
âœ cd hello_cargo

hello_cargo on î‚  master [?] via ğŸ¦€ 1.67.1
âœ ls
Cargo.toml src

hello_cargo on î‚  master [?] via ğŸ¦€ 1.67.1
âœ âœ ls
Cargo.toml src
```

#### `Cargo.toml`

- TOMLï¼ˆTom's Obvious, Minimal Languageï¼‰æ ¼å¼ï¼Œæ˜¯Cargoçš„é…ç½®æ ¼å¼
- [package]ï¼Œæ˜¯ä¸€ä¸ªåŒºåŸŸæ ‡é¢˜ï¼Œè¡¨ç¤ºä¸‹æ–¹å†…å®¹æ˜¯ç”¨æ¥é…ç½®åŒ…ï¼ˆpackageï¼‰çš„
  - name é¡¹ç›®å
  - version é¡¹ç›®ç‰ˆæœ¬
  - authors é¡¹ç›®ä½œè€…
  - edition ä½¿ç”¨çš„Rustç‰ˆæœ¬
- [dependencies] å¦ä¸€ä¸ªåŒºåŸŸçš„å¼€å§‹ï¼Œå®ƒä¼šåˆ—å‡ºé¡¹ç›®çš„ä¾èµ–é¡¹
- åœ¨Rusté‡Œé¢ï¼Œä»£ç çš„åŒ…ç§°ä½œcrate

![](https://raw.githubusercontent.com/qiaopengjun5162/blogpicgo/master/img/202302162243199.png)

#### `src/main.rs`

- cargo ç”Ÿæˆçš„main.rsåœ¨srcç›®å½•ä¸‹
- è€ŒCargo.tomlåœ¨é¡¹ç›®é¡¶å±‚ä¸‹
- æºä»£ç éƒ½åº”è¯¥åœ¨srcç›®å½•ä¸‹
- é¡¶å±‚ç›®å½•å¯ä»¥æ”¾ç½®ï¼šREADMEã€è®¸å¯ä¿¡æ¯ã€é…ç½®æ–‡ä»¶å’Œå…¶å®ƒä¸ç¨‹åºæºç æ— å…³çš„æ–‡ä»¶
- å¦‚æœåˆ›å»ºé¡¹ç›®æ—¶æ²¡æœ‰ä½¿ç”¨cargoï¼Œä¹Ÿå¯ä»¥æŠŠé¡¹ç›®è½¬åŒ–ä¸ºä½¿ç”¨cargoï¼š
  - æŠŠæºä»£ç æ–‡ä»¶ç§»åŠ¨åˆ°srcä¸‹
  - åˆ›å»ºCargo.tomlå¹¶å¡«å†™ç›¸åº”çš„é…ç½®

### æ„å»ºCargoé¡¹ç›® cargo build

- cargo build
  - åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ï¼štarget/debug/hello_cargoæˆ–target\debug\hello_cargo.exe(Windows)
  - è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼š`./target/debug/hello_cargo`æˆ–`.\target\debug\hello_cargo.exe(Windows)`
- ç¬¬ä¸€æ¬¡è¿è¡Œ`cargo build`ä¼šåœ¨é¡¶å±‚ç›®å½•ç”Ÿæˆcargo.lockæ–‡ä»¶
  - è¯¥æ–‡ä»¶è´Ÿè´£è¿½è¸ªé¡¹ç›®ä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬
  - ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹è¯¥æ–‡ä»¶

### æ„å»ºå’Œè¿è¡Œcargoé¡¹ç›® `cargo run`

- cargo run ç¼–è¯‘ä»£ç  + æ‰§è¡Œç»“æœ
  - å¦‚æœä¹‹å‰ç¼–è¯‘æˆåŠŸè¿‡ï¼Œå¹¶ä¸”æºç æ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶

```rust
hello_cargo on î‚  master [?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.67.1
âœ cargo run
   Compiling hello_cargo v0.1.0 (/Users/qiaopengjun/rust/hello_cargo)
    Finished dev [unoptimized + debuginfo] target(s) in 0.38s
     Running `target/debug/hello_cargo`
Hello, world!

hello_cargo on î‚  master [?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.67.1
âœ
```

![](https://raw.githubusercontent.com/qiaopengjun5162/blogpicgo/master/img/202302162243594.png)

#### `cargo check`

- cargo check æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯ä¸äº§ç”Ÿä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶
- cargo chekc è¦æ¯” cargo build å¿«å¾—å¤š
  - ç¼–å†™ä»£ç çš„æ—¶å€™å¯ä»¥è¿ç»­åå¤çš„ä½¿ç”¨cargo chekc æ£€æŸ¥ä»£ç ï¼Œæé«˜æ•ˆç‡

### ä¸ºå‘å¸ƒæ„å»º

- cargo build --release
  - ç¼–è¯‘æ—¶ä¼šè¿›è¡Œä¼˜åŒ–
    - ä»£ç ä¼šè¿è¡Œçš„æ›´å¿«ï¼Œä½†æ˜¯ç¼–è¯‘æ—¶é—´æ›´é•¿
  - ä¼šåœ¨target/releaseè€Œä¸æ˜¯target/debugç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
- ä¸¤ç§é…ç½®
  - å¼€å‘
  - æ­£å¼å‘å¸ƒ

å°½é‡ç”¨Cargo

## çŒœæ•°æ¸¸æˆ-ä¸€æ¬¡çŒœæµ‹

#### çŒœæ•°æ¸¸æˆ - ç›®æ ‡

- ç”Ÿæˆä¸€ä¸ª1åˆ°100é—´çš„éšæœºæ•°
- æç¤ºç©å®¶è¾“å…¥ä¸€ä¸ªçŒœæµ‹
- çŒœå®Œä¹‹åï¼Œç¨‹åºä¼šæç¤ºçŒœæµ‹æ˜¯å¤ªå°äº†è¿˜æ˜¯å¤ªå¤§äº†
- å¦‚æœçŒœæµ‹æ­£ç¡®ï¼Œé‚£ä¹ˆæ‰“å°å‡ºä¸€ä¸ªåº†ç¥ä¿¡æ¯ï¼Œç¨‹åºé€€å‡º

### å†™ä»£ç 

![](https://raw.githubusercontent.com/qiaopengjun5162/blogpicgo/master/img/202302182323253.png)

```rust
use std::io; // prelude

fn main() {
    println!("çŒœæ•°!");

    println!("çŒœæµ‹ä¸€ä¸ªæ•°");

    // let mut foo = 1;
    // let bar = foo; // immutable

    // foo = 2;

    let mut guess = String::new();

    io::stdin().read_line(&mut guess).expect("æ— æ³•è¯»å–è¡Œ");
    // io::Result Ok Err 

    println!("ä½ çŒœæµ‹çš„æ•°æ˜¯ï¼š{}", guess);
}

```

![](https://raw.githubusercontent.com/qiaopengjun5162/blogpicgo/master/img/202302190029828.png)

## çŒœæ•°æ¸¸æˆ - ç”Ÿæˆç¥ç§˜æ•°å­—

[rang]<https://crates.io/crates/rand>

```bash
âœ cd rust/guessing_game

guessing_game on î‚  main [âœ˜!] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.67.1
âœ cargo build
   Compiling cfg-if v1.0.0
   Compiling ppv-lite86 v0.2.17
   Compiling libc v0.2.139
   Compiling getrandom v0.2.8
   Compiling rand_core v0.6.4
   Compiling rand_chacha v0.3.1
   Compiling rand v0.8.5
   Compiling guessing_game v0.1.0 (/Users/qiaopengjun/rust/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 1.08s

guessing_game on î‚  main [âœ˜!] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.67.1
âœ cargo build
    Finished dev [unoptimized + debuginfo] target(s) in 0.03s

guessing_game on î‚  main [âœ˜!] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.67.1
âœ cargo update
```

![](https://raw.githubusercontent.com/qiaopengjun5162/blogpicgo/master/img/202302202323209.png)

éšæœºæ•°

![](https://raw.githubusercontent.com/qiaopengjun5162/blogpicgo/master/img/202302202342562.png)

ä»£ç ï¼š

```rust
use std::io; // prelude
use rand::Rng; // trait

fn main() {
    println!("çŒœæ•°!");

    let secret_number = rand::thread_rng().gen_range(1..101);

    println!("ç¥ç§˜æ•°å­—æ˜¯ï¼š{}", secret_number);

    println!("çŒœæµ‹ä¸€ä¸ªæ•°");

    // let mut foo = 1;
    // let bar = foo; // immutable

    // foo = 2;

    let mut guess = String::new();

    io::stdin().read_line(&mut guess).expect("æ— æ³•è¯»å–è¡Œ");
    // io::Result Ok Err 

    println!("ä½ çŒœæµ‹çš„æ•°æ˜¯ï¼š{}", guess);
}

```

## çŒœæ•°æ¸¸æˆ - æ¯”è¾ƒçŒœæµ‹æ•°å­—ä¸ç¥ç§˜æ•°å­—

```rust
use std::io; // prelude
use rand::Rng; // trait
use std::cmp::Ordering; // æšä¸¾ç±»å‹ ä¸‰ä¸ªå˜ä½“ï¼ˆå€¼ï¼‰

fn main() {
    println!("çŒœæ•°!");

    let secret_number = rand::thread_rng().gen_range(1..101);

    println!("ç¥ç§˜æ•°å­—æ˜¯ï¼š{}", secret_number);

    println!("çŒœæµ‹ä¸€ä¸ªæ•°");

    // let mut foo = 1;
    // let bar = foo; // immutable

    // foo = 2;

    let mut guess = String::new();

    io::stdin().read_line(&mut guess).expect("æ— æ³•è¯»å–è¡Œ");
    // io::Result Ok Err 

    // shadow
    let guess: u32 = guess.trim().parse().expect("Please type a number!"); // \n

    println!("ä½ çŒœæµ‹çš„æ•°æ˜¯ï¼š{}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less => println!("Too small!"), // arm
        Ordering::Greater => println!("Too big!"), 
        Ordering::Equal => println!("You win!"),
    }
}

```

## çŒœæ•°æ¸¸æˆ - å…è®¸å¤šæ¬¡çŒœæµ‹

```rust
use std::io; // prelude
use rand::Rng; // trait
use std::cmp::Ordering; // æšä¸¾ç±»å‹ ä¸‰ä¸ªå˜ä½“ï¼ˆå€¼ï¼‰

fn main() {
    println!("çŒœæ•°!");

    let secret_number = rand::thread_rng().gen_range(1..101);

    // println!("ç¥ç§˜æ•°å­—æ˜¯ï¼š{}", secret_number);

    loop {
        println!("çŒœæµ‹ä¸€ä¸ªæ•°");

        // let mut foo = 1;
        // let bar = foo; // immutable

        // foo = 2;

        let mut guess = String::new();

        io::stdin().read_line(&mut guess).expect("æ— æ³•è¯»å–è¡Œ");
        // io::Result Ok Err 

        // shadow
        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => {
                println!("è¯·è¾“å…¥æ­£ç¡®çš„æ•°å­—");
                continue;
            }
        };
        println!("ä½ çŒœæµ‹çš„æ•°æ˜¯ï¼š{}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"), // arm
            Ordering::Greater => println!("Too big!"), 
            Ordering::Equal => {
                println!("You win!");
                break;
            }
        }
    }
}

```

## é€šç”¨çš„ç¼–ç¨‹æ¦‚å¿µ

- å˜é‡ä¸å¯å˜æ€§
- æ•°æ®ç±»å‹
  - æ ‡é‡ç±»å‹
  - ç¬¦åˆç±»å‹
- å‡½æ•°
- æ³¨é‡Š

### 1 å˜é‡ä¸å¯å˜æ€§

- å£°æ˜å˜é‡ä½¿ç”¨`let`å…³é”®å­—
- é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯ä¸å¯å˜çš„ï¼ˆImmutableï¼‰
  - ï¼ˆä¾‹å­ variablesï¼‰
- å£°æ˜å˜é‡æ—¶ï¼Œåœ¨å˜é‡å‰é¢åŠ ä¸Š`mut`ï¼Œå°±å¯ä»¥ä½¿å˜é‡å¯å˜ã€‚

```bash
~/rust
âœ cargo new variables
     Created binary (application) `variables` package

~/rust
âœ cd var*

variables on î‚  master [?] via ğŸ¦€ 1.67.1
âœ code .

variables on î‚  master [?] via ğŸ¦€ 1.67.1
âœ
```

![](https://raw.githubusercontent.com/qiaopengjun5162/blogpicgo/master/img/202302250858666.png)

ä»£ç ï¼š

```rust
fn main() {
    println!("Hello, world!");

    let mut x = 5;
    println!("The value of x is {}", x);

    x = 6;
    println!("The value of x is {}", x);
}

```

#### å˜é‡ä¸å¸¸é‡

- å¸¸é‡ï¼ˆconstantï¼‰ï¼Œå¸¸é‡åœ¨ç»‘å®šå€¼ä»¥åä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å®ƒä¸ä¸å¯å˜çš„å˜é‡æœ‰å¾ˆå¤šåŒºåˆ«ï¼š
  - ä¸å¯ä»¥ä½¿ç”¨`mut`ï¼Œå¸¸é‡æ°¸è¿œéƒ½æ˜¯ä¸å¯å˜çš„
  - å£°æ˜å¸¸é‡ä½¿ç”¨`const`å…³é”®å­—ï¼Œå®ƒçš„ç±»å‹å¿…é¡»è¢«æ ‡æ³¨
  - å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸå†…è¿›è¡Œå£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸ
  - å¸¸é‡åªå¯ä»¥ç»‘å®šåˆ°å¸¸é‡è¡¨è¾¾å¼ï¼Œæ— æ³•ç»‘å®šåˆ°å‡½æ•°çš„è°ƒç”¨ç»“æœæˆ–åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½è®¡ç®—å‡ºçš„å€¼
- åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå¸¸é‡åœ¨å…¶å£°æ˜çš„ä½œç”¨åŸŸå†…ä¸€ç›´æœ‰æ•ˆ
- å‘½åè§„èŒƒï¼šRusté‡Œå¸¸é‡ä½¿ç”¨å…¨å¤§å†™å­—æ¯ï¼Œæ¯ä¸ªå•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿åˆ†å¼€ï¼Œä¾‹å¦‚ï¼š`MAX_POINTS`
- ä¾‹å­ï¼š`const MAX_POINTS: u32 = 100_000;`

#### Shadowingï¼ˆéšè—ï¼‰

- å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åå­—å£°æ˜æ–°çš„å˜é‡ï¼Œæ–°çš„å˜é‡å°±ä¼šshadowï¼ˆéšè—ï¼‰ä¹‹å‰å£°æ˜çš„åŒåå˜é‡
  - åœ¨åç»­çš„ä»£ç ä¸­è¿™ä¸ªå˜é‡åä»£è¡¨çš„å°±æ˜¯æ–°çš„å˜é‡
- Shadow å’ŒæŠŠå˜é‡æ ‡è®°ä¸ºmutæ˜¯ä¸ä¸€æ ·çš„ï¼š
  - å¦‚æœä¸ä½¿ç”¨letå…³é”®å­—ï¼Œé‚£ä¹ˆé‡æ–°ç»™émutçš„å˜é‡èµ‹å€¼ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯
  - è€Œä½¿ç”¨letå£°æ˜çš„åŒåæ–°å˜é‡ï¼Œä¹Ÿæ˜¯ä¸å¯å˜çš„
  - ä½¿ç”¨letå£°æ˜çš„åŒåæ–°å˜é‡ï¼Œå®ƒçš„ç±»å‹å¯ä»¥ä¸ä¹‹å‰ä¸åŒ

```rust
// const MAX_POINTS: u32 = 100_000;

fn main() {
    // const MAX_POINTS: u32 = 100_000;
    println!("Hello, world!");

    let mut x = 5;
    println!("The value of x is {}", x);

    x = 6;
    println!("The value of x is {}", x);

    let x = x + 1;
    let x = x * 2;
    println!("The value of x is {}", x);

    let spaces = "    ";
    let spaces = spaces.len();
    println!("The length of spaces is {}", spaces);
  
   let guess: u32 = "42".parse().expect("Not a number");

    println!("The guess is {}", guess);
}

```

### 2 æ•°æ®ç±»å‹

- æ ‡é‡å’Œå¤åˆç±»å‹
- Rustæ˜¯é™æ€ç¼–è¯‘è¯­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹
  - åŸºäºä½¿ç”¨çš„å€¼ï¼Œç¼–è¯‘å™¨é€šå¸¸èƒ½å¤Ÿæ¨æ–­å‡ºå®ƒçš„å…·ä½“ç±»å‹
  - ä½†å¦‚æœå¯èƒ½çš„ç±»å‹æ¯”è¾ƒå¤šï¼ˆä¾‹å¦‚æŠŠStringè½¬ä¸ºæ•´æ•°çš„parseæ–¹æ³•ï¼‰ï¼Œå°±å¿…é¡»æ·»åŠ ç±»å‹çš„æ ‡æ³¨ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™

#### æ ‡é‡ç±»å‹

- ä¸€ä¸ªæ ‡é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ä¸ªçš„å€¼
- Rustæœ‰å››ä¸ªä¸»è¦çš„æ ‡é‡ç±»å‹ï¼š
  - æ•´æ•°ç±»å‹
  - æµ®ç‚¹ç±»å‹
  - å¸ƒå°”ç±»å‹
  - å­—ç¬¦ç±»å‹

æ•´æ•°ç±»å‹

- æ•´æ•°ç±»å‹æ²¡æœ‰å°æ•°éƒ¨åˆ†
- ä¾‹å¦‚u32å°±æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ç±»å‹ï¼Œå æ®32ä½çš„ç©ºé—´
- æ— ç¬¦å·æ•´æ•°ç±»å‹ä»¥uå¼€å¤´
- æœ‰ç¬¦å·æ•´æ•°ç±»å‹ä»¥iå¼€å¤´
- Rustçš„æ•´æ•°ç±»å‹åˆ—è¡¨ï¼š
  - æ¯ç§éƒ½åˆ†iå’Œuï¼Œä»¥åŠå›ºå®šçš„ä½æ•°
  - æœ‰ç¬¦å·èŒƒå›´ï¼š -(2^n-1)åˆ°2^{n-1}-1
  - æ— ç¬¦å·èŒƒå›´ï¼š0åˆ°2^n-1

| length  | signed | unsigned |
| :------ | ------ | -------- |
| 8-bit   | i8     | u8       |
| 16-bit  | i16    | u16      |
| 32-bit  | i32    | u32      |
| 64-bit  | i64    | u64      |
| 128-bit | i128   | u128     |
| arch    | isize  | usize    |

#### isizeå’Œusizeç±»å‹

- isizeå’Œusizeç±»å‹çš„ä½æ•°ç”±ç¨‹åºè¿è¡Œçš„è®¡ç®—æœºçš„æ¶æ„æ‰€å†³å®šï¼š
  - å¦‚æœæ˜¯64ä½è®¡ç®—æœºï¼Œé‚£å°±æ˜¯64ä½çš„
  - ...
- ä½¿ç”¨isizeæˆ–usizeçš„ä¸»è¦åœºæ™¯æ˜¯å¯¹æŸç§é›†åˆè¿›è¡Œç´¢å¼•æ“ä½œã€‚

#### æ•´æ•°å­—é¢å€¼

åè¿›åˆ¶ã€åå…­è¿›åˆ¶ã€å…«è¿›åˆ¶ã€äºŒè¿›åˆ¶ã€byte

- é™¤äº†byteç±»å‹å¤–ï¼Œæ‰€æœ‰çš„æ•°å€¼å­—é¢å€¼éƒ½å…è®¸ä½¿ç”¨ç±»å‹åç¼€ã€‚ä¾‹å¦‚ 57u8
- å¦‚æœä½ ä¸å¤ªæ¸…æ¥šåº”è¯¥ä½¿ç”¨é‚£ç§ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨Rustç›¸åº”çš„é»˜è®¤ç±»å‹
- æ•´æ•°çš„é»˜è®¤ç±»å‹å°±æ˜¯i32ï¼Œæ€»ä½“ä¸Šæ¥è¯´é€Ÿåº¦å¾ˆå¿«ï¼Œå³ä½¿åœ¨64ä½ç³»ç»Ÿä¸­

#### æ•´æ•°æº¢å‡º

- ä¾‹å¦‚ï¼šu8çš„èŒƒå›´æ˜¯0-255ï¼Œå¦‚æœä½ æŠŠä¸€ä¸ªu8å˜é‡çš„å€¼è®¾ä¸º256ï¼Œé‚£ä¹ˆï¼š
  - è°ƒè¯•æ¨¡å‹ä¸‹ç¼–è¯‘ï¼šRustä¼šæ£€æŸ¥æ•´æ•°æº¢å‡ºï¼Œå¦‚æœå‘ç”Ÿæº¢å‡ºï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶å°±ä¼španic
  - å‘å¸ƒæ¨¡å‹ä¸‹(--release)ç¼–è¯‘ï¼šRustä¸ä¼šæ£€æŸ¥å¯èƒ½å¯¼è‡´panicçš„æ•´æ•°æº¢å‡º
    - å¦‚æœæº¢å‡ºå‘ç”Ÿï¼šRustä¼šæ‰§è¡Œâ€œç¯ç»•â€æ“ä½œï¼š256å˜æˆ0,257å˜æˆ1... ä½†ç¨‹åºä¸ä¼španic

### æµ®ç‚¹ç±»å‹

- Rustæœ‰ä¸¤ç§åŸºç¡€çš„æµ®ç‚¹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å«æœ‰å°æ•°éƒ¨åˆ†çš„ç±»å‹
  - f32ï¼Œ32ä½ï¼Œå•ç²¾åº¦
  - f64ï¼Œ64ä½ï¼ŒåŒç²¾åº¦
- Rust çš„æµ®ç‚¹ç±»å‹ä½¿ç”¨äº†IEEE-754æ ‡å‡†æ¥è¡¨è¿°
- f64æ˜¯é»˜è®¤ç±»å‹ï¼Œå› ä¸ºåœ¨ç°ä»£CPUä¸Šf64å’Œf32çš„é€Ÿåº¦å·®ä¸å¤šï¼Œè€Œä¸”ç²¾åº¦æ›´é«˜ã€‚

### æ•°å€¼æ“ä½œ

- åŠ å‡ä¹˜é™¤ä½™ç­‰

### å¸ƒå°”ç±»å‹

- Rustçš„å¸ƒå°”ç±»å‹ä¹Ÿæœ‰ä¸¤ä¸ªå€¼ï¼štrue å’Œ false
- ä¸€ä¸ªå­—èŠ‚å¤§å°
- ç¬¦å·æ˜¯bool

### å­—ç¬¦ç±»å‹

- Rustè¯­è¨€ä¸­charç±»å‹è¢«ç”¨æ¥æè¿°è¯­è¨€ä¸­æœ€åŸºç¡€çš„å•ä¸ªå­—ç¬¦
- å­—ç¬¦ç±»å‹çš„å­—é¢å€¼ä½¿ç”¨å•å¼•å·
- å ç”¨4å­—èŠ‚å¤§å°
- æ˜¯Unicodeæ ‡é‡å€¼ï¼Œå¯ä»¥è¡¨ç¤ºæ¯”ASCIIå¤šå¾—å¤šçš„å­—ç¬¦å†…å®¹ï¼šæ‹¼éŸ³ã€ä¸­æ—¥éŸ©æ–‡ã€é›¶é•¿åº¦ç©ºç™½å­—ç¬¦ã€emojiè¡¨æƒ…ç­‰
  - U+0000 åˆ° U+D7FF
  - U+E000 åˆ° U+10FFFF
- ä½†Unicodeä¸­å¹¶æ²¡æœ‰â€œå­—ç¬¦â€çš„æ¦‚å¿µï¼Œæ‰€ä»¥ç›´è§‰ä¸Šè®¤ä¸ºçš„å­—ç¬¦ä¹Ÿè®¸ä¸Rustä¸­çš„æ¦‚å¿µå¹¶ä¸ç›¸ç¬¦

```rust
// const MAX_POINTS: u32 = 100_000;

fn main() {
    // const MAX_POINTS: u32 = 100_000;
    println!("Hello, world!");

    let mut x = 5;
    println!("The value of x is {}", x);

    x = 6;
    println!("The value of x is {}", x);

    let x = x + 1;
    let x = x * 2;
    println!("The value of x is {}", x);

    let spaces = "    ";
    let spaces = spaces.len();
    println!("The length of spaces is {}", spaces);

    let guess: u32 = "42".parse().expect("Not a number");

    println!("The guess is {}", guess);

    // let x = 2.0; // f64

    // let y: f32 = 3.0; // f32

    // let sum = 5 + 10;

    // let difference = 95.5 - 4.3;

    // let product = 4 * 30;

    // let quotient = 56.7 / 32.2;

    // let reminder = 54 % 5;

    // let t = true;

    // let f: bool = false;

    // let x = 'z';
    // let y: char = 'a';
    // let z = 'ğŸ˜˜';
}

```

### å¤åˆç±»å‹

- å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œ
- Rustæä¾›äº†ä¸¤ç§åŸºç¡€çš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆTupleï¼‰ã€æ•°ç»„

#### Tuple

- Tuple  å¯ä»¥å°†å¤šä¸ªç±»å‹çš„å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œ
- Tuple  çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼šä¸€æ—¦å£°æ˜å°±æ— æ³•æ”¹å˜

#### åˆ›å»ºTuple

- åœ¨å°æ‹¬å·é‡Œï¼Œå°†å€¼ç”¨é€—å·åˆ†å¼€
- Tuple ä¸­çš„æ¯ä¸ªä½ç½®éƒ½å¯¹åº”ä¸€ä¸ªç±»å‹ï¼ŒTupleä¸­å„å…ƒç´ çš„ç±»å‹ä¸å¿…ç›¸åŒ

#### è·å–Tupleçš„å…ƒç´ å€¼

- å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥è§£æ„ï¼ˆdestructureï¼‰ä¸€ä¸ªTupleæ¥è·å–å…ƒç´ çš„å€¼

#### è®¿é—®Tupleçš„å…ƒç´ 

- åœ¨Tupleå˜é‡ä½¿ç”¨ç‚¹æ ‡è®°æ³•ï¼Œåæ¥å…ƒç´ çš„ç´¢å¼•å·

```rust
fn main() {

    let tup: (i32, f64, u8) = (500, 6.4, 1);

    println!("{}, {}, {}", tup.0, tup.1, tup.2);

    let (x, y, z) = tup;
    println!("{}, {}, {}", x, y, z);
}

```

#### æ•°ç»„

- æ•°ç»„ä¹Ÿå¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œ
- æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒ
- æ•°ç»„çš„é•¿åº¦ä¹Ÿæ˜¯å›ºå®šçš„

#### å£°æ˜ä¸€ä¸ªæ•°ç»„

- åœ¨ä¸­æ‹¬å·é‡Œï¼Œå„å€¼ç”¨é€—å·åˆ†å¼€

#### æ•°ç»„çš„ç”¨å¤„

- å¦‚æœæƒ³è®©ä½ çš„æ•°æ®å­˜æ”¾åœ¨stackï¼ˆæ ˆï¼‰ä¸Šè€Œä¸æ˜¯heapï¼ˆå †ï¼‰ä¸Šï¼Œæˆ–è€…æƒ³ä¿è¯æœ‰å›ºå®šæ•°é‡çš„å…ƒç´ ï¼Œè¿™æ—¶ä½¿ç”¨æ•°ç»„æ›´æœ‰å¥½å¤„
- æ•°ç»„æ²¡æœ‰Vectorçµæ´»
  - Vectorå’Œæ•°ç»„ç±»ä¼¼ï¼Œå®ƒç”±æ ‡å‡†æ¬¾æä¾›
  - Vectorçš„é•¿åº¦å¯ä»¥æ”¹å˜
  - å¦‚æœä½ ä¸ç¡®å®šåº”è¯¥ç”¨æ•°ç»„è¿˜æ˜¯Vectorï¼Œé‚£ä¹ˆä¼°è®¡ä½ åº”è¯¥ç”¨Vector

#### æ•°ç»„çš„ç±»å‹

- æ•°ç»„çš„ç±»å‹ä»¥è¿™ç§å½¢å¼è¡¨ç¤ºï¼š[ç±»å‹; é•¿åº¦]  ä¾‹å¦‚ï¼š`let a: [i32; 5] = [1, 2, 3, 4, 5];`

#### å¦ä¸€ç§å£°æ˜æ•°ç»„çš„æ–¹æ³•

- å¦‚æœæ•°ç»„çš„æ¯ä¸ªå…ƒç´ å€¼éƒ½ç›¸åŒï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ï¼š
  - åœ¨ä¸­æ‹¬å·é‡ŒæŒ‡å®šåˆå§‹å€¼
  - ç„¶åæ˜¯ä¸€ä¸ªâ€œ;â€
  - æœ€åæ˜¯æ•°ç»„çš„é•¿åº¦
- ä¾‹å¦‚ï¼š`let a = [3; 5];` å®ƒå°±ç›¸å½“äºï¼š`let a = [3, 3, 3, 3, 3];`

#### è®¿é—®æ•°ç»„çš„å…ƒç´ 

- æ•°ç»„æ˜¯stackä¸Šåˆ†é…çš„å•ä¸ªå—çš„å†…å­˜
- å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ 
- å¦‚æœè®¿é—®çš„ç´¢å¼•è¶…å‡ºäº†æ•°ç»„çš„èŒƒå›´ï¼Œé‚£ä¹ˆï¼š
  - ç¼–è¯‘ä¼šé€šè¿‡
  - è¿è¡Œä¼šæŠ¥é”™ï¼ˆruntimeæ—¶ä¼španicï¼‰
    - Rustä¸ä¼šå…è®¸å…¶ç»§ç»­è®¿é—®ç›¸åº”åœ°å€çš„å†…å­˜

```rust
fn main() {
    // let a = [1, 2, 3, 4, 5];

    let months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
    ];

    // let first = months[0];
    // let second = months[1];

    // let index = 15;
    let index = [12, 13, 14, 15];
    let month = months[index[1]];
    println!("{}", month);
}

```

### 2 å‡½æ•°

- å£°æ˜å‡½æ•°ä½¿ç”¨fnå…³é”®å­—
- ä¾ç…§æƒ¯ä¾‹ï¼Œé’ˆå¯¹å‡½æ•°å’Œå˜é‡åï¼ŒRustä½¿ç”¨snake case å‘½åè§„èŒƒ
  - æ‰€æœ‰çš„å­—æ¯éƒ½æ˜¯å°å†™çš„ï¼Œå•è¯ä¹‹é—´ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†å¼€

```rust
fn main() {
    another_function();
}

fn another_function() {
    println!("Another function");
}

```

#### å‡½æ•°çš„å‚æ•°

- parametersï¼Œarguments  (å½¢å‚ï¼Œå®å‚)
- åœ¨å‡½æ•°ç­¾åé‡Œï¼Œå¿…é¡»å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹

```rust
fn main() {
   another_function(5, 6); // argument
}

fn another_function(x: i32, y: i32) { // parameter
    println!("the value of x is {}", x);
    println!("the value of y is {}", y);
}
```

#### å‡½æ•°ä½“ä¸­çš„è¯­å¥ä¸è¡¨è¾¾å¼

- å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆï¼Œå¯é€‰çš„ç”±ä¸€ä¸ªè¡¨è¾¾å¼ç»“æŸ
- Rustæ˜¯ä¸€ä¸ªåŸºäºè¡¨è¾¾å¼çš„è¯­è¨€
- è¯­å¥æ˜¯æ‰§è¡Œä¸€äº›åŠ¨ä½œçš„æŒ‡ä»¤
- è¡¨è¾¾å¼ä¼šè®¡ç®—äº§ç”Ÿä¸€ä¸ªå€¼
- å‡½æ•°çš„å®šä¹‰ä¹Ÿæ˜¯è¯­å¥
- è¯­å¥ä¸è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸å¯ä»¥ä½¿ç”¨letå°†ä¸€ä¸ªè¯­å¥èµ‹ç»™ä¸€ä¸ªå˜é‡

```rust
fn main() {
    let y = 6; // è¯­å¥
    // let x = (let y = 6); // æŠ¥é”™
  
   let x = 5;

    let y = {
        let x = 1;
        x + 3
    };

    println!("The value of y is {}", y)
}
```

#### å‡½æ•°çš„è¿”å›å€¼

- åœ¨->ç¬¦å·åè¾¹å£°æ˜å‡½æ•°è¿”å›å€¼çš„ç±»å‹ï¼Œä½†æ˜¯ä¸å¯ä»¥ä¸ºè¿”å›å€¼å‘½å
- åœ¨Rusté‡Œé¢ï¼Œè¿”å›å€¼å°±æ˜¯å‡½æ•°ä½“é‡Œé¢æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼
- è‹¥æƒ³æå‰è¿”å›ï¼Œéœ€ä½¿ç”¨returnå…³é”®å­—ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªå€¼
  - å¤§å¤šæ•°å‡½æ•°éƒ½æ˜¯é»˜è®¤ä½¿ç”¨æœ€åä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºè¿”å›å€¼

```rust
fn plus_five(x: i32) -> i32 {
    x + 5
}

fn main() {
   let x = plus_five(6);
   println!("The value of x is {}", x);
}
```

#### æ³¨é‡Š

- Rustè¿˜æœ‰ä¸€ç§â€œæ–‡æ¡£æ³¨é‡Šâ€

```rust
// This is a function
fn five(x: i32) -> i32 {
  x + 5
}

/* sdgagaf
sfgagaga */
// This is main function
// The entry point
fn main() {
  // call five()
  let x = five(6); // 5 + 6
  
  println!("The value of x is: {}", x);
}
```

### 3 æ§åˆ¶æµ

#### if è¡¨è¾¾å¼

- ifè¡¨è¾¾å¼å…è®¸æ‚¨æ ¹æ®æ¡ä»¶æ¥æ‰§è¡Œä¸åŒçš„ä»£ç åˆ†æ”¯
  - è¿™ä¸ªæ¡ä»¶å¿…é¡»æ˜¯boolç±»å‹
- ifè¡¨è¾¾å¼ä¸­ï¼Œä¸æ¡ä»¶ç›¸å…³è”çš„ä»£ç å—å«åšåˆ†æ”¯ï¼ˆarmï¼‰
- å¯é€‰çš„ï¼Œåœ¨åè¾¹å¯ä»¥åŠ ä¸Šä¸€ä¸ªelseè¡¨è¾¾å¼

```rust
fn main() {
    println!("Hello, world!");

    let number = 7;

    if number < 5 {
        println!("condition was true");
    } else {
        println!("condition was false");
    }
}

```

#### ä½¿ç”¨else if å¤„ç†å¤šé‡æ¡ä»¶

- å¦‚æœä½¿ç”¨å¤šäºä¸€ä¸ªelse ifï¼Œé‚£ä¹ˆæœ€å¥½ä½¿ç”¨matchæ¥é‡æ„ä»£ç 

```rust
fn main() {
    let number = 6;

    if number % 4 == 0 {
        println!("number is divisible by 4");
    } else if number % 3 == 0 {
        println!("number is divisible by 3");
    } else if number % 2 == 0 {
        println!("number is divisible by 2");
    } else {
        println!("number is not divisible by 4, 3 or 2");
    }
}

```

ä½¿ç”¨match

```rust
fn main() {
    let number = 6;
    match number {
        number if number % 4 == 0 => println!("number is divisible by 4"),
        number if number % 3 == 0 => println!("number is divisible by 3"),
        number if number % 2 == 0 => println!("number is divisible by 2"),
        _ => println!("number is not divisible by 4, 3 or 2"),
    }
}

```

#### åœ¨letè¯­å¥ä¸­ä½¿ç”¨If

- å› ä¸ºifæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ‰€ä»¥å¯ä»¥å°†å®ƒæ”¾åœ¨letè¯­å¥ä¸­ç­‰å·çš„å³è¾¹

```rust
fn main() {
    let condition = true;

    let number = if condition {5} else {6};

    println!("The value of number is {}", number);
}
```

#### Rustçš„å¾ªç¯

- Rustæä¾›äº†3ç§å¾ªç¯ï¼šloopï¼Œwhileå’Œfor

#### loopå¾ªç¯

- loopå…³é”®å­—å‘Šè¯‰Ruståå¤çš„æ‰§è¡Œä¸€å—ä»£ç ï¼Œç›´åˆ°ä½ å–Šåœ
- å¯ä»¥åœ¨loopå¾ªç¯ä¸­ä½¿ç”¨breakå…³é”®å­—æ¥å‘Šè¯‰ç¨‹åºä½•æ—¶åœæ­¢å¾ªç¯

```rust
fn main() {
    let mut counter = 0;

    let result = loop {
        counter += 1;

        if counter == 10 {
            break counter * 2;
        }
    };

    println!("The result is {}", result);
}

```

#### While æ¡ä»¶å¾ªç¯

- æ¯æ¬¡æ‰§è¡Œå¾ªç¯ä½“ä¹‹å‰éƒ½åˆ¤æ–­ä¸€æ¬¡æ¡ä»¶

```rust
fn main() {
  let mut number = 3;
  
  while number != 0 {
    println!("{}", number);
    number = number - 1;
  }
  println!("LIFTOFF!!!");
}
```

#### ä½¿ç”¨forå¾ªç¯éå†é›†åˆ

- å¯ä»¥ä½¿ç”¨whileæˆ–loopæ¥éå†é›†åˆï¼Œä½†æ˜¯æ˜“é”™ä¸”ä½æ•ˆ

```rust
fn main() {
    let a = [10, 20, 30, 40, 50];
    let mut index = 0;

    while index < 5 {
        println!("the index is {}", a[index]);

        index = index + 1;
    }
}

```

- ä½¿ç”¨forå¾ªç¯æ›´ç®€æ´ç´§å‡‘ï¼Œå®ƒå¯ä»¥é’ˆå¯¹é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æ¥æ‰§è¡Œä¸€äº›ä»£ç 

```rust
fn main() {
  let a = [10, 20, 30, 40, 50];
  for element in a.iter() {
    println!("the value is {}", element);
  }
}
```

- ç”±äºforå¾ªç¯çš„å®‰å…¨ã€ç®€æ´æ€§ï¼Œæ‰€ä»¥å®ƒåœ¨Rusté‡Œç”¨çš„æœ€å¤š

#### Range

- æ ‡å‡†åº“æä¾›
- æŒ‡å®šä¸€ä¸ªå¼€å§‹æ•°å­—å’Œä¸€ä¸ªç»“æŸæ•°å­—ï¼ŒRangeå¯ä»¥ç”Ÿæˆå®ƒä»¬ä¹‹é—´çš„æ•°å­—ï¼ˆä¸å«ç»“æŸï¼‰
- revæ–¹æ³•å¯ä»¥åè½¬Range

```rust
fn main() {
    for number in (1..4).rev() {
        println!("{}", number);
    }
    println!("LIFTOFF!!!");
}

```

### 4 æ‰€æœ‰æƒ

- æ‰€æœ‰æƒæ˜¯Rustæœ€ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œå®ƒè®©Rustæ— éœ€GCå°±å¯ä»¥ä¿è¯å†…å­˜å®‰å…¨

#### 4.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ

- Rustçš„æ ¸å¿ƒç‰¹æ€§å°±æ˜¯æ‰€æœ‰æƒ
- æ‰€æœ‰ç¨‹åºåœ¨è¿è¡Œæ—¶éƒ½å¿…é¡»ç®¡ç†å®ƒä»¬ä½¿ç”¨è®¡ç®—æœºå†…å­˜çš„æ–¹å¼
  - æœ‰äº›è¯­è¨€æœ‰åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒä»¬ä¼šä¸æ–­åœ°å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜
  - åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼Œç¨‹åºå‘˜å¿…é¡»æ˜¾ç¤ºåœ°åˆ†é…å’Œé‡Šæ”¾å†…å­˜
- Rusté‡‡ç”¨äº†ç¬¬ä¸‰ç§æ–¹å¼ï¼š
  - å†…å­˜æ˜¯é€šè¿‡ä¸€ä¸ªæ‰€æœ‰æƒç³»ç»Ÿæ¥ç®¡ç†çš„ï¼Œå…¶ä¸­åŒ…å«ä¸€ç»„ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥çš„è§„åˆ™
  - å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œæ‰€æœ‰æƒç‰¹æ€§ä¸ä¼šå‡æ…¢ç¨‹åºçš„è¿è¡Œé€Ÿåº¦

#### Stack VS Heap

æ ˆå†…å­˜ VS å †å†…å­˜

- åœ¨åƒRustè¿™æ ·çš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€é‡Œï¼Œä¸€ä¸ªå€¼æ˜¯åœ¨stackä¸Šè¿˜æ˜¯åœ¨heapä¸Šå¯¹è¯­è¨€çš„è¡Œä¸ºå’Œä½ ä¸ºä»€ä¹ˆè¦åšæŸäº›å†³å®šæ—¶æœ‰æ›´å¤§çš„å½±å“çš„
- åœ¨ä½ çš„ä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œstackå’Œheapéƒ½æ˜¯ä½ å¯ç”¨çš„å†…å­˜ï¼Œä½†ä»–ä»¬çš„ç»“æ„å¾ˆä¸ç›¸åŒ

å­˜å‚¨æ•°æ®

- StackæŒ‰å€¼çš„æ¥æ”¶é¡ºåºæ¥å­˜å‚¨ï¼ŒæŒ‰ç›¸åçš„é¡ºåºå°†å®ƒä»¬ç§»é™¤ï¼ˆåè¿›å…ˆå‡ºï¼ŒLIFOï¼‰
  - æ·»åŠ æ•°æ®å«åšå‹å…¥æ ˆ
  - ç§»é™¤æ•°æ®å«åšå¼¹å‡ºæ ˆ
- æ‰€æœ‰å­˜å‚¨åœ¨stackä¸Šçš„æ•°æ®å¿…é¡»æ‹¥æœ‰å·²çŸ¥çš„å›ºå®šçš„å¤§å°
  - ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ•°æ®æˆ–è¿è¡Œæ—¶å¤§å°å¯èƒ½å‘ç”Ÿå˜åŒ–çš„æ•°æ®å¿…é¡»å­˜æ”¾åœ¨heapä¸Š
- Heapå†…å­˜ç»„ç»‡æ€§å·®ä¸€äº›
  - å½“ä½ æŠŠæ•°æ®æ”¾å…¥heapæ—¶ï¼Œä½ ä¼šè¯·æ±‚ä¸€å®šæ•°é‡çš„ç©ºé—´
  - æ“ä½œç³»ç»Ÿåœ¨heapé‡Œæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºåœ¨ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªç©ºé—´çš„åœ°å€
  - è¿™ä¸ªè¿‡ç¨‹å«åšåœ¨heapä¸Šè¿›è¡Œåˆ†é…ï¼Œæœ‰æ—¶ä»…ä»…ç§°ä¸ºâ€œåˆ†é…â€
- æŠŠå€¼å‹åˆ°stackä¸Šä¸å«åˆ†é…
- å› ä¸ºæŒ‡é’ˆæ˜¯å·²çŸ¥å›ºå®šå¤§å°çš„ï¼Œå¯ä»¥æŠŠæŒ‡é’ˆå­˜æ”¾åœ¨stackä¸Š
  - ä½†å¦‚æœæƒ³è¦å®é™…æ•°æ®ï¼Œä½ å¿…é¡»ä½¿ç”¨æŒ‡é’ˆæ¥å®šä½
- æŠŠæ•°æ®å‹åˆ°stackä¸Šè¦æ¯”åœ¨heapä¸Šåˆ†é…å¿«å¾—å¤š
  - å› ä¸ºæ“ä½œç³»ç»Ÿä¸éœ€è¦å¯»æ‰¾ç”¨æ¥å­˜å‚¨æ–°æ•°æ®çš„ç©ºé—´ï¼Œé‚£ä¸ªä½ç½®æ°¸è¿œéƒ½åœ¨stackçš„é¡¶ç«¯
- åœ¨heapä¸Šåˆ†é…ç©ºé—´éœ€è¦åšæ›´å¤šçš„å·¥ä½œ
  - æ“ä½œç³»ç»Ÿé¦–å…ˆéœ€è¦æ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—´æ¥å­˜æ”¾æ•°æ®ï¼Œç„¶åè¦åšå¥½è®°å½•æ–¹ä¾¿ä¸‹æ¬¡åˆ†é…

è®¿é—®æ•°æ®

- è®¿é—®heapä¸­çš„æ•°æ®è¦æ¯”è®¿é—®stackä¸­çš„æ•°æ®æ…¢ï¼Œå› ä¸ºéœ€è¦é€šè¿‡æŒ‡é’ˆæ‰èƒ½æ‰¾åˆ°heapä¸­çš„æ•°æ®
  - å¯¹äºç°ä»£çš„å¤„ç†å™¨æ¥è¯´ï¼Œç”±äºç¼“å­˜çš„ç¼˜æ•…ï¼Œå¦‚æœæŒ‡ä»¤åœ¨å†…å­˜ä¸­è·³è½¬çš„æ¬¡æ•°è¶Šå°‘ï¼Œé‚£ä¹ˆé€Ÿåº¦å°±è¶Šå¿«
- å¦‚æœæ•°æ®å­˜æ”¾çš„è·ç¦»æ¯”è¾ƒè¿‘ï¼Œé‚£ä¹ˆå¤„ç†å™¨çš„å¤„ç†é€Ÿåº¦å°±ä¼šæ›´å¿«ä¸€äº›ï¼ˆstackä¸Šï¼‰
- å¦‚æœæ•°æ®ä¹‹é—´çš„è·ç¦»æ¯”è¾ƒè¿œï¼Œé‚£ä¹ˆå¤„ç†é€Ÿåº¦å°±ä¼šæ…¢ä¸€äº›ï¼ˆheapä¸Šï¼‰
  - åœ¨heapä¸Šåˆ†é…å¤§é‡çš„ç©ºé—´ä¹Ÿæ˜¯éœ€è¦æ—¶é—´çš„

å‡½æ•°è°ƒç”¨

- å½“ä½ çš„ä»£ç è°ƒä½£å‡½æ•°æ—¶ï¼Œå€¼è¢«ä¼ å…¥åˆ°å‡½æ•°ï¼ˆä¹ŸåŒ…æ‹¬æŒ‡å‘heapçš„æŒ‡é’ˆï¼‰ã€‚å‡½æ•°æœ¬åœ°çš„å˜é‡è¢«å‹åˆ°stackä¸Šã€‚å½“å‡½æ•°ç»“æŸåï¼Œè¿™äº›å€¼ä¼šä»stackä¸Šå¼¹å‡º

æ‰€æœ‰æƒå­˜åœ¨çš„åŸå› 

- æ‰€æœ‰æƒè§£å†³çš„é—®é¢˜ï¼š
  - è·Ÿè¸ªä»£ç çš„å“ªäº›éƒ¨åˆ†æ­£åœ¨ä½¿ç”¨heapçš„å“ªäº›æ•°æ®
  - æœ€å°åŒ–heapä¸Šçš„é‡å¤æ•°æ®é‡
  - æ¸…ç†heapä¸Šæœªä½¿ç”¨çš„æ•°æ®ä»¥é¿å…ç©ºé—´ä¸è¶³
- ä¸€æ—¦ä½ æ‡‚çš„äº†æ‰€æœ‰æƒï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ç»å¸¸å»æƒ³stackæˆ–heapäº†
- ä½†æ˜¯çŸ¥é“ç®¡ç†heapæ•°æ®æ˜¯æ‰€æœ‰æƒå­˜åœ¨çš„åŸå› ï¼Œè¿™æœ‰åŠ©äºè§£é‡Šå®ƒä¸ºä»€ä¹ˆä¼šè¿™æ ·å·¥ä½œ

#### æ‰€æœ‰æƒè§„åˆ™

- æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯è¯¥å€¼çš„æ‰€æœ‰è€…
- æ¯ä¸ªå€¼åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
- å½“æ‰€æœ‰è€…è¶…å‡ºä½œç”¨åŸŸï¼ˆscopeï¼‰æ—¶ï¼Œè¯¥å€¼å°†è¢«åˆ é™¤

#### å˜é‡ä½œç”¨åŸŸ

- Scopeå°±æ˜¯ç¨‹åºä¸­ä¸€ä¸ªé¡¹ç›®çš„æœ‰æ•ˆèŒƒå›´

```rust
fn main() {
  // s ä¸å¯ç”¨
  let s = "hello"; // s å¯ç”¨
                   // å¯ä»¥å¯¹ s è¿›è¡Œç›¸å…³æ“ä½œ 
} // s ä½œç”¨åŸŸåˆ°æ­¤ç»“æŸï¼Œs ä¸å†å¯ç”¨
```

#### String ç±»å‹

- String æ¯”é‚£äº›åŸºç¡€æ ‡é‡æ•°æ®ç±»å‹æ›´å¤æ‚
- å­—ç¬¦ä¸²å­—é¢å€¼ï¼šç¨‹åºé‡Œæ‰‹å†™çš„é‚£äº›å­—ç¬¦ä¸²å€¼ã€‚å®ƒä»¬æ˜¯ä¸å¯å˜çš„
- Rustè¿˜æœ‰ç¬¬äºŒç§å­—ç¬¦ä¸²ç±»å‹ï¼šString
  - åœ¨heapä¸Šåˆ†é…ã€‚èƒ½å¤Ÿå­˜å‚¨åœ¨ç¼–è¯‘æ—¶æœªçŸ¥æ•°é‡çš„æ–‡æœ¬

#### åˆ›å»ºStringç±»å‹çš„å€¼

- å¯ä»¥ä½¿ç”¨fromå‡½æ•°ä»å­—ç¬¦ä¸²å­—é¢å€¼åˆ›å»ºå‡ºStringç±»å‹
- let s = String::from("hellp");
  - â€œ::â€è¡¨ç¤ºfromæ˜¯Stringç±»å‹ä¸‹çš„å‡½æ•°
- è¿™ç±»å­—ç¬¦ä¸²æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„

```rust
fn main() {
    let mut s = String::from("Hello");

    s.push_str(", World");

    println!("{}", s);
}

```

- ä¸ºä»€ä¹ˆStringç±»å‹çš„å€¼å¯ä»¥ä¿®æ”¹ï¼Œè€Œå­—ç¬¦ä¸²å­—é¢å€¼å´ä¸èƒ½ä¿®æ”¹ï¼Ÿ
  - å› ä¸ºå®ƒä»¬å¤„ç†å†…å­˜çš„æ–¹å¼ä¸åŒ

#### å†…å­˜å’Œåˆ†é…

- å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å®ƒçš„å†…å®¹äº†ï¼Œå…¶æ–‡æœ¬å†…å®¹ç›´æ¥è¢«ç¡¬ç¼–ç åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶é‡Œ
  - é€Ÿåº¦å¿«ã€é«˜æ•ˆã€‚æ˜¯å› ä¸ºå…¶ä¸å¯å˜æ€§
- Stringç±»å‹ï¼Œä¸ºäº†æ”¯æŒå¯å˜æ€§ï¼Œéœ€è¦åœ¨heapä¸Šåˆ†é…å†…å­˜æ¥ä¿å­˜ç¼–è¯‘æ—¶æœªçŸ¥çš„æ–‡æœ¬å†…å®¹ï¼š
  - æ“ä½œç³»ç»Ÿå¿…é¡»åœ¨è¿è¡Œæ—¶æ¥è¯·æ±‚å†…å­˜
    - è¿™æ­¥é€šè¿‡è°ƒç”¨`String::from`æ¥å®ç°
  - å½“ç”¨å®ŒStringä¹‹åï¼Œéœ€è¦ä½¿ç”¨æŸç§æ–¹å¼å°†å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿ
    - è¿™æ­¥ï¼Œåœ¨æ‹¥æœ‰GCçš„è¯­è¨€ä¸­ï¼ŒGCä¼šè·Ÿè¸ªå¹¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å†…å­˜
    - æ²¡æœ‰GCï¼Œå°±éœ€è¦æˆ‘ä»¬å»è¯†åˆ«å†…å­˜ä½•æ—¶ä¸å†ä½¿ç”¨ï¼Œå¹¶è°ƒç”¨ä»£ç å°†å®ƒè¿”å›
      - å¦‚æœå¿˜äº†ï¼Œé‚£å°±æµªè´¹å†…å­˜
      - å¦‚æœæå‰åšäº†ï¼Œå˜é‡å°±ä¼šéæ³•
      - å¦‚æœåšäº†ä¸¤æ¬¡ï¼Œä¹Ÿæ˜¯Bugï¼Œå¿…é¡»ä¸€æ¬¡åˆ†é…å¯¹åº”ä¸€æ¬¡é‡Šæ”¾
- Rusté‡‡ç”¨äº†ä¸åŒçš„æ–¹å¼ï¼šå¯¹äºæŸä¸ªå€¼æ¥è¯´ï¼Œå½“æ‹¥æœ‰å®ƒçš„å˜é‡èµ°å‡ºä½œç”¨èŒƒå›´æ—¶ï¼Œå†…å­˜ä¼šç«‹å³è‡ªåŠ¨çš„äº¤è¿˜ç»™æ“ä½œç³»ç»Ÿ
- DROPå‡½æ•°ï¼ˆå½“å˜é‡èµ°å‡ºä½œç”¨åŸŸçš„æ—¶å€™ï¼ŒRustä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼‰

#### å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šç§»åŠ¨ï¼ˆMoveï¼‰

- å¤šä¸ªå˜é‡å¯ä»¥ä¸åŒä¸€ä¸ªæ•°æ®ä½¿ç”¨ä¸€ç§ç‹¬ç‰¹çš„æ–¹å¼æ¥äº¤äº’

```rust
let x = 5;
let y = x;
```

- æ•´æ•°æ˜¯å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„ç®€å•çš„å€¼ï¼Œè¿™ä¸¤ä¸ª5å€å‹åˆ°äº†stackä¸­

Stringç‰ˆæœ¬

```rust
let s1 = String::from("hello");
let s2 = s1;
```

- ä¸€ä¸ªStringç”±3éƒ¨åˆ†ç»„æˆï¼š
  - ä¸€ä¸ªæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„å†…å­˜çš„æŒ‡é’ˆï¼ˆptrï¼‰
  - ä¸€ä¸ªé•¿åº¦ï¼ˆlenï¼‰
  - ä¸€ä¸ªå®¹é‡ï¼ˆcapacityï¼‰
- ä¸Šé¢è¿™äº›ä¸œè¥¿æ”¾åœ¨stackä¸Š
- å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„éƒ¨åˆ†åœ¨heapä¸Š
- é•¿åº¦lenï¼Œå°±æ˜¯å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹æ‰€éœ€çš„å­—èŠ‚æ•°
- å®¹é‡capacityæ˜¯æŒ‡Stringä»æ“ä½œç³»ç»Ÿæ€»å…±è·å¾—å†…å­˜çš„æ€»å­—èŠ‚æ•°
- å½“æŠŠs1èµ‹ç»™s2ï¼ŒStringçš„æ•°æ®è¢«å¤åˆ¶äº†ä¸€ä»½ï¼š
  - åœ¨stackä¸Šå¤åˆ¶äº†ä¸€ä»½æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡
  - å¹¶æ²¡æœ‰å¤åˆ¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„heapä¸Šçš„æ•°æ®
- å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼ŒRustä¼šè‡ªåŠ¨è°ƒç”¨DROPå‡½æ•°ï¼Œå¹¶å°†å˜é‡ä½¿ç”¨çš„heapå†…å­˜é‡Šæ”¾
- å½“s1ã€s2ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ï¼š
  - äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble freeï¼‰bug
- ä¸ºäº†ä¿è¯å†…å­˜å®‰å…¨ï¼š
  - Rustæ²¡æœ‰å°è¯•å¤åˆ¶è¢«åˆ†é…çš„å†…å­˜
  - Rustè®©s1å¤±æ•ˆ
    - å½“s1ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ï¼ŒRustä¸éœ€è¦é‡Šæ”¾ä»»ä½•ä¸œè¥¿
- æµ…æ‹·è´ï¼ˆshallow copyï¼‰
- æ·±æ‹·è´ï¼ˆdeep copyï¼‰
- ä½ ä¹Ÿè®¸ä¼šå°†å¤åˆ¶æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡è§†ä¸ºæµ…æ‹·è´ï¼Œä½†ç”±äºRustè®©s1å¤±æ•ˆäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°çš„æœ¯è¯­ï¼šç§»åŠ¨ï¼ˆMoveï¼‰
- éšå«çš„ä¸€ä¸ªè®¾è®¡åŸåˆ™ï¼šRustä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„æ·±æ‹·è´
  - å°±è¿è¡Œæ—¶æ€§èƒ½è€Œè¨€ï¼Œä»»ä½•è‡ªåŠ¨èµ‹å€¼çš„æ“ä½œéƒ½æ˜¯å»‰ä»·çš„

#### å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šå…‹éš†ï¼ˆCloneï¼‰

- å¦‚æœçœŸæƒ³å¯¹heapä¸Šé¢çš„Stringæ•°æ®è¿›è¡Œæ·±åº¦æ‹·è´ï¼Œè€Œä¸ä»…ä»…æ˜¯stackä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨Cloneæ–¹æ³•

```rust
fn main() {
  let s1 = String::from("Hello");
  let s2 = s1.clone();
  
  println!("{}, {}", s1, s2);
}
```

#### Stackä¸Šçš„æ•°æ®ï¼šå¤åˆ¶

```rust
fn main() {
  let x = 5;
  let y = x;
  
  println!("{}, {}", x, y);
}
```

- Copy traitï¼Œ å¯ä»¥ç”¨äºåƒæ•´æ•°è¿™æ ·å®Œå…¨å­˜æ”¾åœ¨stackä¸Šé¢çš„ç±»å‹
- å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†Copyè¿™ä¸ªtraitï¼Œé‚£ä¹ˆæ—§çš„å˜é‡åœ¨èµ‹å€¼åä»ç„¶å¯ç”¨
- å¦‚æœä¸€ä¸ªç±»å‹æˆ–è€…è¯¥ç±»å‹çš„ä¸€éƒ¨åˆ†å®ç°äº†Drop traitï¼Œé‚£ä¹ˆRustä¸å…è®¸è®©å®ƒå†å»å®ç°Copy Traitäº†

#### ä¸€äº›æ‹¥æœ‰Copy Trait çš„ç±»å‹

- ä»»ä½•ç®€å•æ ‡é‡çš„ç»„åˆç±»å‹éƒ½å¯ä»¥æ˜¯Copyçš„
- ä»»ä½•éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§èµ„æºçš„éƒ½ä¸æ˜¯Copyçš„
- ä¸€äº›æ‹¥æœ‰Copy Traitçš„ç±»å‹ï¼š
  - æ‰€æœ‰çš„æ•´æ•°ç±»å‹ï¼Œä¾‹å¦‚u32
  - bool
  - char
  - æ‰€æœ‰çš„æµ®ç‚¹ç±»å‹ï¼Œä¾‹å¦‚f64
  - Tupleï¼ˆå…ƒç»„ï¼‰ï¼Œå¦‚æœèµ·æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯Copyçš„
    - `(i32, i32)`æ˜¯
    - `(i32, String)`ä¸æ˜¯

#### æ‰€æœ‰æƒä¸å‡½æ•°

- åœ¨è¯­ä¹‰ä¸Šï¼Œå°†å€¼ä¼ é€’ç»™å‡½æ•°å’ŒæŠŠå€¼èµ‹ç»™å˜é‡æ˜¯ç±»ä¼¼çš„ï¼š
  - å°†å€¼ä¼ é€’ç»™å‡½æ•°å°†å‘ç”Ÿç§»åŠ¨æˆ–å¤åˆ¶

```rust
fn main() {
    let s = String::from("Hello, World!");

    take_ownership(s);

    let x = 5;

    makes_copy(x);

    println!("x: {}", x);
}

fn take_ownership(some_string: String) {
    println!("{}", some_string)
}

fn makes_copy(some_number: i32) {
    println!("{}", some_number);
}

```

#### è¿”å›å€¼ä¸ä½œç”¨åŸŸ

- å‡½æ•°åœ¨è¿”å›å€¼çš„è¿‡ç¨‹ä¸­åŒæ ·ä¹Ÿä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»

```rust
fn main() {
    let s1 = gives_ownership();

    let s2 = String::from("hello");

    let s3 = takes_and_gives_back(s2);
}

fn gives_ownership() -> String {
    let some_string = String::from("hello");
    some_string
}

fn takes_and_gives_back(a_string: String) -> String {
    a_string
}

```

- ä¸€ä¸ªå˜é‡çš„æ‰€æœ‰æƒæ€»æ˜¯éµå¾ªåŒæ ·çš„æ¨¡å‹ï¼š
  - æŠŠä¸€ä¸ªå€¼èµ‹ç»™å…¶ä»–å˜é‡æ—¶å°±ä¼šå‘ç”Ÿç§»åŠ¨
  - å½“ä¸€ä¸ªåŒ…å«heapæ•°æ®çš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒçš„å€¼å°±ä¼šè¢«Dropå‡½æ•°æ¸…ç†ï¼Œé™¤éæ•°æ®çš„æ‰€æœ‰æƒç§»åŠ¨åˆ°å¦ä¸€ä¸ªå˜é‡ä¸Šäº†

#### å¦‚ä½•è®©å‡½æ•°ä½¿ç”¨æŸä¸ªå€¼ï¼Œä½†ä¸è·å¾—å…¶æ‰€æœ‰æƒï¼Ÿ

```rust
fn main() {
  let s1 = String::from("hello");
  
  let (s2, len) = calculate_length(s1);
  
  println!("The length of '{}' is {}.", s2, len);
}

fn calculate_length(s: String) -> (String, usize) {
  let length = s.len();
  
  (s, length)
}
```

- Rustæœ‰ä¸€ä¸ªç‰¹æ€§å«åšâ€œå¼•ç”¨ï¼ˆReferenceï¼‰â€

### 4.2 å¼•ç”¨å’Œå€Ÿç”¨

```rust
fn main() {
  let s1 = String::from("Hello");
  let len = calculate_length(&s1);
  
  println!("The length of '{}' is {}.", s1, len);
}

fn calculate_length(s: &String) -> usize {
  s.len()
}
```

- å‚æ•°çš„ç±»å‹æ˜¯ &String è€Œä¸æ˜¯ String
- & ç¬¦å·å°±è¡¨ç¤ºå¼•ç”¨ï¼šå…è®¸ä½ å¼•ç”¨æŸäº›å€¼è€Œä¸å–å¾—å…¶æ‰€æœ‰æƒ

#### å€Ÿç”¨

- æˆ‘ä»¬æŠŠå¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°è¿™ä¸ªè¡Œä¸ºå«åšå€Ÿç”¨
- æ˜¯å¦å¯ä»¥ä¿®æ”¹å€Ÿç”¨çš„ä¸œè¥¿ï¼Ÿ ä¸è¡Œ
- å’Œå˜é‡ä¸€æ ·ï¼Œå¼•ç”¨é»˜è®¤ä¹Ÿæ˜¯ä¸å¯å˜çš„

#### å¯å˜å¼•ç”¨

- å¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šåœ¨ç‰¹å®šä½œç”¨åŸŸå†…ï¼Œå¯¹æŸä¸€å—æ•°æ®ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå¯å˜çš„å¼•ç”¨
  - è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯åœ¨ç¼–è¯‘æ—¶é˜²æ­¢æ•°æ®ç«äº‰
- ä»¥ä¸‹ä¸‰ç§è¡Œä¸ºä¸‹ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ï¼š
  - ä¸¤ä¸ªæˆ–å¤šä¸ªæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®
  - è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆç”¨äºå†™å…¥æ•°æ®
  - æ²¡æœ‰ä½¿ç”¨ä»»ä½•æœºåˆ¶æ¥åŒæ­¥å¯¹æ•°æ®çš„è®¿é—®
- å¯ä»¥é€šè¿‡åˆ›å»ºæ–°çš„ä½œç”¨åŸŸï¼Œæ¥å…è®¸éåŒæ—¶çš„åˆ›å»ºå¤šä¸ªå¯å˜å¼•ç”¨

```rust
fn main() {
  let mut s = String::from("Hello");
  {
    let s1 = &mut s;
  }
  
  let s2 = &mut s;
}
```

#### å¦å¤–ä¸€ä¸ªé™åˆ¶

- ä¸å¯ç”¨åŒæ—¶æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨å’Œä¸€ä¸ªä¸å¯å˜çš„å¼•ç”¨
- å¤šä¸ªä¸å¯å˜çš„å¼•ç”¨æ˜¯å¯ä»¥çš„

```rust
fn main() {
  let mut s = String::from("Hello");
  let r1 = &s;
  let r2 = &s;
  let s1 = &mut s;  // æŠ¥é”™
  
  println!("{} {} {}", r1, r2, s1);
}
```

#### æ‚¬ç©ºå¼•ç”¨ Dangling References

- æ‚¬ç©ºæŒ‡é’ˆï¼ˆDangling Pointerï¼‰ï¼šä¸€ä¸ªæŒ‡é’ˆå¼•ç”¨äº†å†…å­˜ä¸­çš„æŸä¸ªåœ°å€ï¼Œè€Œè¿™å—å†…å­˜å¯èƒ½å·²ç»é‡Šæ”¾å¹¶åˆ†é…ç»™å…¶å®ƒäººä½¿ç”¨äº†ã€‚
- åœ¨Rusté‡Œï¼Œç¼–è¯‘å™¨å¯ä¿è¯å¼•ç”¨æ°¸è¿œéƒ½ä¸æ˜¯æ‚¬ç©ºå¼•ç”¨ï¼š
  - å¦‚æœä½ å¼•ç”¨äº†æŸäº›æ•°æ®ï¼Œç¼–è¯‘å™¨å°†ä¿è¯åœ¨å¼•ç”¨ç¦»å¼€ä½œç”¨åŸŸä¹‹å‰æ•°æ®ä¸ä¼šç¦»å¼€ä½œç”¨åŸŸ

#### å¼•ç”¨çš„è§„åˆ™

- åœ¨ä»»ä½•ç»™å®šçš„æ—¶åˆ»ï¼Œåªèƒ½æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¹‹ä¸€ï¼š
  - ä¸€ä¸ªå¯å˜çš„å¼•ç”¨
  - ä»»æ„æ•°é‡ä¸å¯å˜çš„å¼•ç”¨
- å¼•ç”¨å¿…é¡»ä¸€ç›´æœ‰æ•ˆ

### 4.3 åˆ‡ç‰‡

- Rustçš„å¦å¤–ä¸€ç§ä¸æŒæœ‰æ‰€æœ‰æƒçš„æ•°æ®ç±»å‹ï¼šåˆ‡ç‰‡ï¼ˆsliceï¼‰
- ä¸€é“é¢˜ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼š
  - å®ƒæ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°
  - è¿”å›å®ƒåœ¨è¿™ä¸ªå­—ç¬¦ä¸²é‡Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå•è¯
  - å¦‚æœå‡½æ•°æ²¡æ‰¾åˆ°ä»»ä½•ç©ºæ ¼ï¼Œé‚£ä¹ˆæ•´ä¸ªå­—ç¬¦ä¸²å°±è¢«è¿”å›
- å°è¯•è§£ç­”

```rust
fn main() {
    let mut s  = String::from("Hello world");
    let word_index = first_world(&s);

    println!("{}", word_index);
}

fn first_world(s: &String) -> usize {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return i;
        }
    }
    s.len()
}

```

#### å­—ç¬¦ä¸²åˆ‡ç‰‡

- å­—ç¬¦ä¸²åˆ‡ç‰‡æ˜¯æŒ‡å‘å­—ç¬¦ä¸²ä¸­ä¸€éƒ¨åˆ†å†…å®¹çš„å¼•ç”¨
- å½¢å¼ï¼š[å¼€å§‹ç´¢å¼•..ç»“æŸç´¢å¼•]
  - å¼€å§‹ç´¢å¼•å°±æ˜¯åˆ‡ç‰‡èµ·å§‹ä½ç½®çš„ç´¢å¼•å€¼
  - ç»“æŸç´¢å¼•æ˜¯åˆ‡ç‰‡ç»ˆæ­¢ä½ç½®çš„ä¸‹ä¸€ä¸ªç´¢å¼•å€¼

```rust
fn main() {
  let s = String::from("Hello world");
  
  let hello = &s[0..5];
  let world = &s[6..11];
  
  println!("{}, {}", hello, world);
}
```

#### æ³¨æ„

- å­—ç¬¦ä¸²åˆ‡ç‰‡çš„èŒƒå›´ç´¢å¼•å¿…é¡»å‘ç”Ÿåœ¨æœ‰æ•ˆçš„UTF-8å­—ç¬¦è¾¹ç•Œå†…
- å¦‚æœå°è¯•ä»ä¸€ä¸ªå¤šå­—èŠ‚çš„å­—ç¬¦ä¸­åˆ›å»ºå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œç¨‹åºä¼šæŠ¥é”™å¹¶é€€å‡º

#### ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡é‡å†™ä¾‹å­

```rust
fn main() {
    let s  = String::from("Hello world");
    let word_index = first_world(&s);

    println!("{}", word_index);
}

fn first_world(s: &String) -> &str {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[..i];
        }
    }
    &s[..]
}

```

#### å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯åˆ‡ç‰‡

- å­—ç¬¦ä¸²å­—é¢å€¼è¢«ç›´æ¥å­˜å‚¨åœ¨äºŒè¿›åˆ¶ç¨‹åºä¸­
- let s = "Hello, World!";

```rust
fn main() {
  let s = "Hello world";
  
  println!("{}", s)
}
```

- å˜é‡sçš„ç±»å‹æ˜¯&strï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘äºŒè¿›åˆ¶ç¨‹åºç‰¹å®šä½ç½®çš„åˆ‡ç‰‡
  - &str æ˜¯ä¸å¯å˜å¼•ç”¨ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å­—é¢å€¼ä¹Ÿæ˜¯ä¸å¯å˜çš„

#### å°†å­—ç¬¦ä¸²åˆ‡ç‰‡ä½œä¸ºå‚æ•°ä¼ é€’

- `fn first_word(s: &String) -> &str {`
- æœ‰ç»éªŒçš„Rustå¼€å‘è€…ä¼šé‡‡ç”¨&strä½œä¸ºå‚æ•°ç±»å‹ï¼Œå› ä¸ºè¿™æ ·å°±å¯ä»¥åŒæ—¶æ¥æ”¶Stringå’Œ&strç±»å‹çš„å‚æ•°äº†ï¼š
- `fn first_word(s: &str) -> &str {`
  - ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œç›´æ¥è°ƒç”¨è¯¥å‡½æ•°
  - ä½¿ç”¨Stringï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„Stringåˆ‡ç‰‡æ¥è°ƒç”¨è¯¥å‡½æ•°
- å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡æ¥ä»£æ›¿å­—ç¬¦ä¸²å¼•ç”¨ä¼šä½¿æˆ‘ä»¬çš„APIæ›´åŠ é€šç”¨ï¼Œä¸”ä¸ä¼šæŸå¤±ä»»ä½•åŠŸèƒ½
- å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡

```rust
fn main() {
    let my_string  = String::from("Hello world");
    let word_index = first_world(&my_string[..]);

    println!("{}", word_index);

    let my_string_literal = "hello world";
    let word_literal = first_world(my_string_literal);

    println!("word_literal: {}", word_literal);
}

fn first_world(s: &str) -> &str {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[..i];
        }
    }
    &s[..]
}

```

#### å…¶ä»–ç±»å‹çš„åˆ‡ç‰‡

```rust
fn main() {
  let a = [1, 2, 3, 4, 5];
  let slice = &a[1..3];
}
```
