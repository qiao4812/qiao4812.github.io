---
title: "ç”¨Rustå®ç°ä¸€ä¸ªæŒ‰ç…§æŒ‡å®šåˆ†éš”ç¬¦åˆ†å‰²å­—ç¬¦ä¸²çš„å‡½æ•°"
date: 2023-07-31T22:58:44+08:00
lastmod: 2023-07-31T22:58:44+08:00 
draft: true
categories: ["Rust"]
tags: ["Rust"]
---

# ç”¨Rustå®ç°ä¸€ä¸ªæŒ‰ç…§æŒ‡å®šåˆ†éš”ç¬¦åˆ†å‰²å­—ç¬¦ä¸²çš„å‡½æ•°

### strtokstrtok æ–‡æ¡£ä»‹ç»ï¼š

è¿™æ˜¯ä¸€ä¸ªåä¸º `strtok` çš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå¯å˜çš„å­—ç¬¦ä¸²å¼•ç”¨ `s` å’Œä¸€ä¸ªå­—ç¬¦ `pat` ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª `&str` ç±»å‹çš„å€¼ã€‚
 å‡½æ•°çš„ä½œç”¨æ˜¯å°†å­—ç¬¦ä¸² `s` æŒ‰ç…§å­—ç¬¦ `pat` è¿›è¡Œåˆ†å‰²ï¼Œå¹¶è¿”å›åˆ†å‰²åçš„å­å­—ç¬¦ä¸²ã€‚
 å‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼š

 - é¦–å…ˆï¼Œä½¿ç”¨ `find` æ–¹æ³•æŸ¥æ‰¾å­—ç¬¦ä¸² `s` ä¸­ç¬¬ä¸€æ¬¡å‡ºç°å­—ç¬¦ `pat` çš„ä½ç½®ã€‚
- å¦‚æœæ‰¾åˆ°äº†å­—ç¬¦ `pat` ï¼Œåˆ™å°†å­—ç¬¦ä¸² `s` åˆ†å‰²æˆä¸¤éƒ¨åˆ†ï¼šå‰ç¼€ `prefix` å’Œåç¼€ `suffix` ã€‚
  - å‰ç¼€ `prefix` æ˜¯ä»å­—ç¬¦ä¸² `s` çš„å¼€å¤´åˆ°å­—ç¬¦ `pat` ä¹‹å‰çš„éƒ¨åˆ†ã€‚
  - åç¼€ `suffix` æ˜¯ä»å­—ç¬¦ `pat` ä¹‹ååˆ°å­—ç¬¦ä¸² `s` çš„æœ«å°¾çš„éƒ¨åˆ†ã€‚
- ç„¶åï¼Œå°†åç¼€ `suffix` èµ‹å€¼ç»™å­—ç¬¦ä¸² `s` ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ `strtok` æ—¶ç»§ç»­å¤„ç†å‰©ä½™çš„éƒ¨åˆ†ã€‚
- æœ€åï¼Œè¿”å›å‰ç¼€ `prefix` ä½œä¸ºå‡½æ•°çš„ç»“æœã€‚
 å¦‚æœåœ¨å­—ç¬¦ä¸² `s` ä¸­æ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ `pat` ï¼Œåˆ™å°†æ•´ä¸ªå­—ç¬¦ä¸² `s` ä½œä¸ºå‰ç¼€ `prefix` è¿”å›ï¼Œå¹¶å°†å­—ç¬¦ä¸² `s` ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚

### strtok.rs ä»£ç 

```bash
// strtok(s = "hello world", " ")
// return "hello", s = "world"

pub fn strtok<'a>(s: &'a mut &str, pat: char) -> &'a str {
    match s.find(pat) {
        Some(i) => {
            let prefix = &s[..i]; // hello
            let suffix = &s[i + pat.len_utf8()..]; // char æ˜¯ Unicode &str ä¸­çš„ç©ºæ ¼æ˜¯ utf-8 æ•… pat å çš„ä½ç½®ä¸ä¸€å®šæ˜¯1
            *s = suffix;
            prefix
        }
        None => {
            let prefix = *s;
            *s = "";
            prefix
        }
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_works() {
        let mut s = "hello world";
        assert_eq!(s.find(' '), Some(5));

        let s1 = &mut s;
        let t = strtok(s1, ' ');
        assert_eq!(t, "hello");
        assert_eq!(*s1, "world");
    }
}

```

è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªåä¸ºstrtokçš„å‡½æ•°ï¼Œç”¨äºå°†ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†å‰²ã€‚
 ä»£ç æ­¥éª¤å¦‚ä¸‹ï¼š
1. æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå¯å˜çš„å­—ç¬¦ä¸²å¼•ç”¨så’Œä¸€ä¸ªå­—ç¬¦patä½œä¸ºåˆ†éš”ç¬¦ã€‚
2. ä½¿ç”¨matchè¯­å¥å¯¹å­—ç¬¦ä¸²sä¸­æ˜¯å¦å­˜åœ¨åˆ†éš”ç¬¦è¿›è¡ŒåŒ¹é…ã€‚
3. å¦‚æœå­˜åœ¨åˆ†éš”ç¬¦ï¼Œåˆ™æ‰§è¡ŒSomeåˆ†æ”¯ã€‚
4. åœ¨Someåˆ†æ”¯ä¸­ï¼Œä½¿ç”¨s.find(pat)æ–¹æ³•æ‰¾åˆ°åˆ†éš”ç¬¦çš„ä½ç½®iã€‚
5. ä½¿ç”¨åˆ‡ç‰‡æ“ä½œç¬¦(&s[..i])è·å–åˆ†éš”ç¬¦ä¹‹å‰çš„éƒ¨åˆ†ä½œä¸ºå‰ç¼€prefixã€‚
6. ä½¿ç”¨åˆ‡ç‰‡æ“ä½œç¬¦(&s[i + pat.len_utf8()..])è·å–åˆ†éš”ç¬¦ä¹‹åçš„éƒ¨åˆ†ä½œä¸ºåç¼€suffixã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œç”±äºå­—ç¬¦patå¯èƒ½å ç”¨å¤šä¸ªutf-8ç¼–ç çš„å­—èŠ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨pat.len_utf8()æ¥è®¡ç®—åˆ†éš”ç¬¦çš„é•¿åº¦ã€‚
7. å°†sçš„å€¼æ›´æ–°ä¸ºåç¼€suffixã€‚
8. è¿”å›å‰ç¼€prefixä½œä¸ºç»“æœã€‚
9. å¦‚æœä¸å­˜åœ¨åˆ†éš”ç¬¦ï¼Œåˆ™æ‰§è¡ŒNoneåˆ†æ”¯ã€‚
10. åœ¨Noneåˆ†æ”¯ä¸­ï¼Œå°†sçš„å€¼æ›´æ–°ä¸ºç©ºå­—ç¬¦ä¸²""ã€‚
11. è¿”å›åŸå§‹çš„sä½œä¸ºç»“æœã€‚
 æ€»ç»“ï¼šè¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªæŒ‰ç…§æŒ‡å®šåˆ†éš”ç¬¦åˆ†å‰²å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œå¦‚æœå­˜åœ¨åˆ†éš”ç¬¦ï¼Œåˆ™è¿”å›åˆ†éš”ç¬¦ä¹‹å‰çš„éƒ¨åˆ†ä½œä¸ºç»“æœï¼›å¦‚æœä¸å­˜åœ¨åˆ†éš”ç¬¦ï¼Œåˆ™è¿”å›æ•´ä¸ªå­—ç¬¦ä¸²ä½œä¸ºç»“æœã€‚



æµ‹è¯•

```bash
training_code on î‚  master [?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.71.0 via ğŸ…’ base 
âœ cargo test strtok::tests::it_works             
    Finished test [unoptimized + debuginfo] target(s) in 0.01s
     Running unittests src/lib.rs (target/debug/deps/training_code-c41752abc7a3994f)

running 1 test
test strtok::tests::it_works ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out; finished in 0.00s

```

